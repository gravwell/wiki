# Gravwell ライセンスシステム

Gravwell では、追加の機能を利用できるいくつかのライセンス層を提供しています。 最も基本的なライセンス層は Community Edition で、最も高度なライセンス層は Unlimited ライセンスです。 Community Edition では、1 台のインデクサへのインジェストが制限されており、インジェスト無制限ではない唯一のライセンス層です。

Gravwell は、デフォルトでは /opt/gravwell/etc/license にあるライセンスファイルを使用してライセンスを取得します。 ライセンスの場所は、gravwell.conf ファイルの [Global] 設定ブロックで License-Location 変数を設定することで制御できます。 Gravwell は起動毎にライセンスを検証し、定期的にチェックを行います。

## ライセンスのインストール

ライセンスのインストールは、GUI、CLI、またはライセンスファイルを適切な場所にコピーすることで行うことができます。 GUI または CLI を使用してライセンスを更新できるのは、管理者ユーザーのみです。 起動時に、ライセンスがインストールされていないか、現在のライセンスが無効な場合、システムは有効なライセンスがインストールされるのを待ちます。 GUI ではライセンスのアップロードを促し、有効なライセンスを待ってから起動を完了します。 ライセンスインストール API は提供されたライセンスを検証し、無効なライセンスをインストールすることはできません。

![Upload a License](upload.png)

![License Install](install.png)

CLI または GUI を使用してライセンスをインストールした場合、Gravwell は接続されたすべてのインデクサーにライセンスを自動的に配布します。 Gravwell は、各インデクサーにインストールされたライセンスを検証し、必要に応じて接続ごとに更新します。 つまり、新しいインデクサーをオンラインにすると、ウェブサーバが接続されたときに自動的に適切なライセンスを受け取ることができるのです。

## ライセンスの更新

Gravwell のライセンス更新は、CLI または GUI を使用して Gravwell を再起動せずに行うことができますが、ライセンスファイルを適切なディレクトリにコピーしただけでは、ライセンスを再読み込みするために Gravwell を再起動する必要があります。 GUI や CLI でライセンスファイルを更新できるのは管理者のみです。 ライセンスを更新するには、管理者として Gravwell にログインし、管理者パネルの下にあるライセンスセクションに移動します。 ライセンスページには、ライセンスの詳細とその有効期限が表示されます。新しいライセンスファイルを選択してアップロードすると、ウェブサーバと接続されているすべての Gravwell インデクサーが更新されます。

![License Page](navpanel.png)

![License Info](licinfo.png)

![License Upload](licupload.png)

## ライセンスの有効期限

Gravwell のすべてのライセンスには有効期限があり、ライセンスが切れると Gravwell は起動しません。 ライセンスの有効期限は 4 段階に分かれています。

1. 有効期限が近づいているという警告
2. 期限切れの猶予期間
3. インジェストが無効
4. 検索が無効

ライセンスの有効期限が切れる前には、GUI 上にライセンスの有効期限が迫っていることを警告する通知が表示され、有効期限が切れると 14 日間の猶予期間が設けられ、Gravwell は完全に機能します。 猶予期間中は Gravwell の使用を継続できますが、Gravwell のインデクサやウェブサーバを再起動すると停止して有効なライセンスを待ちます。 猶予期間が終了すると、Gravwell はインジェストを無効にします。この状態では、データのクエリは可能ですが、Gravwell は新しいデータをインジェストしません。 クエリ猶予期間が終了すると、検索機能が無効になります。

ライセンスの期限切れでデータが削除されることはありません。保存されたデータ、リソース、ダッシュボード、クエリの履歴はすべて保存されます。新しいライセンスをインストールしても、すべてのデータはそのまま残ります。

ここでは、ライセンス満了までとその後のイベントを説明する便利な表をご紹介します。


| イベント | 説明 | ライセンス満了までの期間 |
|-------|-------------|:--------------------------:|
| 警告 1 | ライセンスの有効期限が 30 日以内であることを示す通知 | T - 30 日 |
| 警告 2 | ライセンスの有効期限が 15 日以内であることを示す通知 | T - 15 日 |
| 満了 | ライセンスが失効したことを示す通知、14日間の猶予期間開始 | T - 0 |
| インジェストの無効化 | インジェストが無効になり、ライセンスの有効期限が切れたことを示す通知が表示される | T + 15 日 |
| クエリの無効化 | 検索が無効になり、ライセンスが失効したことを示す通知が表示される | T + 30 日 |
