# Diff

diffモジュールは、列挙値の差を求めるモジュールです。このモジュールは、次の2つのモードで動作します:

1. 現在のエントリにある2つの列挙値の差を求める。("ノーマルモード")
2. 現在のエントリの列挙値と、*前*のエントリの同じ列挙値の差を見つける。("一時モード")

このモジュールは、整数、浮動小数点数、タイムスタンプ、および時間の長さの違いを見つけることができます。列挙値が文字列の場合、diffはまず文字列を数値として解析しようとします。

## 例

2つの値の差を求めるには、2つの列挙値の名前を引数として指定し、最初の値から2番目の値を差し引きます。次の例では、DstPort - SrcPort を含む "diff" という名前の列挙値が生成されます:

```
tag=netflow netflow SrcPort DstPort | diff DstPort SrcPort | table
```

![](diff1.png)

(特に役に立つわけではないが、このツールがどのように機能するかを示している。)

次のクエリでは、その他のモードを使用して、現在のエントリのTIMESTAMPフィールドと前のエントリのTIMESTAMPフィールドを比較し、ネットフロー・パケットの到着頻度を確認しています:

```
tag=netflow sort by time asc | diff TIMESTAMP | table
```

![](diff2.png)

## 出力オプション

デフォルトでは、モジュールは、計算された差を含む `diff` という名前の新しい列挙値を作成します。この名前は、"as"キーワードで変更することができます:

```
diff foo bar as foobarDiff
```

## キーイング

一時モード（列挙値と前のエントリの値を比較する）の場合、diffは指定されたキーセットに基づいて複数の"前のエントリ"を保存することができます。次のクエリは、ネットワーク・パケットからソースIPアドレスを抽出し、そのIPが見られなくなってからどれくらい経っているかを調べます:

```
tag=pcap sort by time asc | packet ipv4.SrcIP | diff TIMESTAMP by SrcIP | table
```

![](diff3.png)