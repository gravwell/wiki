# Diff

diffモジュールは、列挙された値の差を求めます。2つのモードで動作します:

1. 現在のエントリで列挙された2つの値の間の差を求めます。("通常モード")
2. 現在のエントリの列挙された値と、*前*のエントリの同じ列挙された値との差を求めます。("時系列モード")

このモジュールは、整数、浮動小数点、タイムスタンプ、および持続時間の違いを見つけることができます。列挙された値が文字列の場合、diffは最初に文字列を数値として解析しようとします。

## 例

2つの列挙値名を引数に指定することで、2つの値の間の差を見つけることができ、2つ目の値は1つ目の値から減算されます。以下は、DstPort - SrcPortを含む「diff」という名前の列挙値を生成します:

```
tag=netflow netflow SrcPort DstPort | diff DstPort SrcPort | table
```

![](diff1.png)

(特に有用ではありませんが、ツールがどのように動作するかを示しています)

次のクエリは他のモードを使用します。現在のエントリの TIMESTAMP フィールドと前のエントリのそれとを比較して、ネットフロー パケットがどのくらいの頻度で到着しているかを確認します:

```
tag=netflow sort by time asc | diff TIMESTAMP | table
```

![](diff2.png)

## 出力オプション

デフォルトでは、モジュールは計算された差分を含む `diff` という名前の新しい列挙値を作成します。この名前は "as" キーワードで変更できます。 例:

```
diff foo bar as foobarDiff
```

## キーイング

一時モード (列挙された値と前のエントリの値を比較する) の場合、diff は、指定されたキーセットに基づいて複数の "前のエントリ" を格納することができます。次のクエリは、ネットワークパケットからソースIPアドレスを抽出し、そのIPが見られてからどのくらいの時間が経過しているかを調べます:

```
tag=pcap sort by time asc | packet ipv4.SrcIP | diff TIMESTAMP by SrcIP | table
```

![](diff3.png)