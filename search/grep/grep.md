## Grep

Grepは、テキスト文字列（Unicodeではない）を検索する非常に基本的なパイプラインモジュールです。そのようなテキストを含むレコードはすべて一致し、パイプラインを通過します。テキストを含まないレコードはパイプラインから削除されます。例えば、`grep foo` は "foo" というテキストを含むレコードを渡し、その中のどこにも "foo" が含まれていないレコードはすべて削除します。Grep は大文字小文字を区別しますので、`grep foo` は "foo" にマッチしますが、"Foo" は削除します。 また、Grepはprintfと同様にエスケープコードの標準セットをサポートしており、 バイナリフィルタも可能です。

Grepは標準的なGNUワイルドカードと高速な文字列とバイナリのマッチングをサポートしています。 0バイトかNバイトで区切られた "foo" と "bar" を含むすべてのエントリを探すには、`grep foo*bar`を使うことができます。 利用可能なワイルドカードの詳細については TLDP miniguide[1] を参照してください。

Grep では、複数のパターンを指定することができます。パターンにマッチするものがあれば、そのエントリはパイプラインの下に渡されます。`-v` フラグを使用して検索を反転させた場合、*すべての*パターンが一致した場合にはエントリは削除されます。

### サポートされているオプション

* `-v`: "逆"のgrep。例えば、`grep -v bar`とすると、"bar"というテキストを含むすべてのレコードを削除し、"bar"を含まないすべてのレコードを検索します。
* `-i`: 大文字小文字を区別しない値と一致します。したがって、`grep -i foo`とすると、"Foo" と "foo" は一致します。大文字小文字を区別しない検索は、最も時間のかかる操作の一つです。高速性を維持するために、可能な限りパイプラインの後半に配置してください。
* `-e <arg>`: レコード全体ではなく、列挙値に対して操作します。例えば、HTTPテキストを含むが80番ポートに向けられていないパケットを表示するパイプラインは次のようになります。`tag=pcap packet ipv4.DstPort!=80 tcp.Payload | grep -e Payload "GET / HTTP/1.1"`
* `-s`: 厳密な一致。すべてのパターンが一致しなければならず、否定された厳密な一致の場合には、どのパターンも一致しない可能性があります。
* `-simple`: 単純な一致。このフラグを指定すると、`grep`はワイルドカードを使わずに、指定した文字に正確に一致します。これにより、アスタリスクやその他の通常予約されている文字を見つけることができます: `grep -s * `
* `-w`: 単語の一致です。 一致パターン全体が、フルテキストエクストラクタで一致する単語である必要があります。

重要: 大文字小文字を区別しない検索はかなり遅くなります。大文字小文字を区別しないgrepを行わなければならない場合は、速度を向上させるために、検索パイプラインの後半に置くようにしてください。

重要: ワイルドカードで単語の境界を越えることができるため、`-w`の単語の一致は単純な一致を意味します。

### パラメータ構造
```
grep <argument list> <search parameter>
```

### 検索例

"Mozilla\*Firefox"という文字列（ワイルドカードなし）を含むすべてのApacheログを検索します:

```
tag=apache grep "Mozilla\*Firefox"
```

ポート80を経由するパケットのうち、ペイロードが0, 1, 2, 3のバイトで始まるものを見つけるには次のように検索します:

```
tag=pcap packet tcp.Port==80 tcp.Payload | grep -e Payload "\x01\x02\x03\x04"
```

"ing"または "ed"で終わる単語を含むRedditの投稿に一致します:

```
tag=reddit json Body | grep -e Body "*ing" "*ed"
```

"Ask"で始まる、または "foo"を含むサブリットへのRedditの投稿をすべて削除します:

```
tag=reddit json Subreddit | grep -v -e Subreddit "Ask*" "foo"
```

MozillaとWindowsを含むユーザーエージェントのみを抽出します。

```
tag=apache grep -s Mozilla Windows
```

### 単語一致の使用

単語照合システムは、完全な単語を照合するように設計されています。 -wフラグを付けたGrepは、フルテキスト・インデックス・システムと対話するための主要な方法の1つです。

-wフラグは、値を選択するときにいくつかの追加の特異性を作成するように設計されています。いくつかのサンプルデータを見て、一致するものとしないものを確認します。

```
16.246.30.72 - - [08/May/2017:15:20:35 -0600] "DELETE /search/tag/list HTTP/1.0" 200 5032 "http://nguyen.biz/category/tags/tag/home.htm" "Opera/8.74.(Windows 98; Win 9x 4.90; it-IT) Presto/2.9.173 Version/11.00"
```

grep のいくつかの呼び出しを見て、一致するものとしないものを確認してみましょう:

| Grepの呼び出し | 一致 | 説明 |
|-----------------|---------|-------------|
| grep Ver        |   YES   | `Version / 11.00`バイトパターンにより、単純なgrepが一致します。 |
| grep -w Ver     |   NO    | Verは完全な単語ではないため、単語の一致は `Version / 11.00`パターンと一致しません。 |
| grep -w Ver*    |   NO    | `-w`は単純な一致を意味し、リテラルバイト`Ver *`はログにないため、単語の一致は一致しません。 |
| grep -w Version |   YES   | バージョンは完全な単語であり、 `/`文字は分割文字であるため、単語一致は一致します。 |
| grep -w "11.00" |   YES   | 単語は一致します。`.`文字の後にスペースが続く場合は区切り文字にすぎません。これにより、IPアドレスの一致が許可されます。 |
| grep -w "Version/11.00" |  ERROR  | The grep module will grepモジュールはエラーを表示します。一致に単語境界文字を含めることはできません。 |
