## words

words は、分割文字で区切られたテキストの単語を検索する、シンプルなテキストマッチングエンジンです。 words モジュールは、機能的には `grep -s -w` と同等であり、フルテキストアクセラレータと相互に作用するように設計されています。 wordsはUTF8の文字エンコーディングをサポートしており、通常はバイナリデータをうまく扱うことができます。つまり、pcapのストリームの中から「foo」という単語を探すことができるのです。 しかし、wordsモジュールが単語の境界でどのようにブレークするかを理解することは重要です。 word `foo` がバイナリデータストリーム中のバイト 0x44 に隣接している場合、word モジュールはその単語を `Dfoo` と認識し、クエリ用語 `foo` にはマッチしません。 wordsは未知のデータを扱う際の最初のレベルのフィルタとして最適です。

ワイルドカードに対応した単語照合が必要な場合は、[grep](../grep/grep.md) モジュールの `-w` フラグをご利用ください。

`words`モジュールでは、複数のパターンを指定することができ、デフォルトではstrictモードになっています。これは、すべてのパターンがマッチしなければエントリがパイプラインに渡されないことを意味します。 これは、すべてのパターンがマッチしなければ、エントリがパイプラインに渡されないことを意味します。`any`のマッチング動作が必要な場合は、`-or`フラグで、いずれかの単語がマッチすれば、エントリがパイプラインに渡されることを指定します。 words`モジュールは、単語を含まないエントリを検索できるように、反転したロジックもサポートしています。

### サポートされているオプション

* `-v`: 逆のマッチ。例えば、`words -v bar`とすると、"bar" という単語を含むレコードをすべて削除し、"bar" という単語を含まないレコードをすべて通過させることができます。
* `-e <arg>`: レコード全体ではなく、列挙値に対して操作を行います。例えば、HTTP テキストを含むが 80 番ポートに向けられていないパケットを表示するパイプラインは、`tag=pcap packet ipv4.DstPort!=80 tcp.Payload | words -e Payload GET HTTP 1.1"` となります。
* `-or`: 任意のマッチ。いずれかのパターンにマッチした場合、そのエントリーを通過させます。negateフラグと組み合わせると、単語が欠落しているエントリーを削除します。

### パラメータ構造
```
words <argument list> <search parameter>
```

### 検索例

`Mozilla` と `Firefox` という言葉を含む Apache のログを探します：

```
tag=apache words Mozilla Firefox
```

80 番ポートを宛先とするパケットのうち、ペイロードに HTTP や 1.1 という単語が含まれていないものを探します：

```
tag=pcap packet tcp.Port==80 tcp.Payload | words -e Payload -v HTTP 1.1
```

`Gravwell` または `gravwell` という言葉を含む Reddit の投稿にマッチします：

```
tag=reddit json Body | words -e Body -or Gravwell gravwell
```

Mozilla と Windows を含むユーザーエージェントのみを取り込みます：

```
tag=apache words Mozilla Windows
```

### 単語のマッチ

単語照合システムは、完全な単語を照合するように設計されています。 単語は、値を選択する際に、さらに具体性を持たせるように設計されています。いくつかのデータ例を見て、何がマッチするか、何がマッチしないかを確認してみましょう。

```
16.246.30.72 - - [08/May/2017:15:20:35 -0600] "DELETE /search/tag/list HTTP/1.0" 200 5032 "http://nguyen.biz/category/tags/tag/home.htm" "Opera/8.74.(Windows 98; Win 9x 4.90; it-IT) Presto/2.9.173 Version/11.00"
```

いくつかの `words` の呼び出しを見て、何がマッチするのか、しないのかを見てみましょう。

| 呼び出し | <div style="min-width: 40px;">マッチするか</div> | 説明 |
|-----------------|---------|-------------|
| words Ver       |   しない    | Ver は完全な単語ではないため、単語モジュールは `Version/11.00` パターンにはマッチしません。 |
| words 16.246.30.72   |   する    |「.」文字はバウンダリデリミタではないので、単語は IP にマッチします。 |
| Words 8.74|する| 単語「8.74」の後ろに「.」文字があっても、単語は「8.74」の値にマッチします。 これは、". "文字がトリム文字とみなされ、マッチから削除されるためです。 これは、句読点（". "や", "や";"）が使用されている場合でも、自然言語の単語にマッチするようにするためです。|
| words Version   |   する   | Version は完全な単語で、`/` は分割文字なので、words モジュールはマッチします。 |
| words 11.00     |   する     | 単語はマッチします。`.` の文字は、スペースが続く場合のみセパレーターとなり、IPアドレスを照合することができます。 |
| words "Version/11.00"   |  エラー  | words モジュールはエラーを出します。マッチの中に単語の境界文字を入れることはできません。 |
| words "Ver*"   |  しない  | words モジュールは、"*" 文字をワイルドカードとして扱わず、完全な単語 "Ver*" を探しているため、マッチしません。 |
