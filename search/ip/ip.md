# IP

ipモジュールは、列挙値をIP型に変換し、オプションでフィルタリングを行うことができます。これにより、例えば JSON 構造体から IP アドレスを含む文字列を抽出し、 ip モジュールを使用してその文字列を IP アドレスに変換し、それが特定のサブネット内にあるかどうかをチェックすることができます。

## サポートされているオプション

* `-or`: "or" フラグは、フィルタのいずれかが成功した場合に、 ipモジュールがエントリをパイプラインに続けることを許可するように指定する。
* `-categorize`: もし"-categorize"フラグが設定されている場合、モジュールは各列挙値を "PRIVATE"、"PUBLIC"、"MULTICAST "のいずれかに分類しようとします。`ip -categorize srcIP`を実行すると、カテゴリ文字列を含む "srcIP_category"という名前の列挙値が作成されます。

## 処理演算子

ipモジュールに渡された列挙値は、以下の演算子を使用してIPアドレスまたはサブネットと比較することができます。

| 演算子 | 名前 | 説明 |
|----------|------|-------------|
| == | 等しい | IPは与えられたアドレスと同じでなければなりません。
| != | 等しくない | IP は、与えられたアドレスと同じであってはなりません。
| ~ | 含む | IPは与えられたサブネットのメンバーでなければなりません。
| !~ | 含まない | IPは与えられたサブネットのメンバーであってはなりません。

ipモジュールは、標準のプライベートネットワークにマッチするキーワード PRIVATE を定義します:

* 10.0.0.0/8
* 172.16.0.0/12
* 192.168.0.0/16
* 127.0.0.0/8
* 224.0.0.0/24
* 169.254.0.0/16
* fd00::/8
* fe80::/10

## 例

### 文字列をIPに変換する

'ipaddr'フィールドを含む JSON 形式のエントリを想定して、そのフィールドを抽出し、後で使用するために IP アドレスに変換します:

```
tag=json json ipaddr | ip ipaddr
```

結果のIP列挙値は、元の値を上書きするのではなく、別の列挙値名に割り当てることもできます:

```
tag=json json ipaddr | ip ipaddr as IP
```

### アドレスまたはサブネットによるフィルタリング

3番目のフィールドに接続元の IP アドレスが記述された CSV 形式のデータを想定すると、192.168.1.5 以外の接続はすべてドロップすることができます:

```
tag=csv csv [2] as srcip | ip srcip==192.168.1.5
```

また、ローカルサブネットから発生した接続を排除することもできます:

```
tag=csv csv [2] as srcip | ip srcip !~ 192.168.0.0/16
```

### PRIVATEキーワードを使用する

3番目のフィールドに接続元のIPアドレスが記述されたCSV形式のデータを想定すると、 ipモジュールを使用してプライベートネットワークからのエントリのみを保持することができます:

```
tag=csv csv [2] as srcip | ip srcip ~ PRIVATE
```

### IPアドレスの分類

3番目のフィールドに接続元のIPアドレスが記述されたCSV形式のデータを想定して、IPモジュールを使用してIPアドレスごとにネットワークカテゴリを割り当てることができます:

```
tag=csv csv [2] as srcip | ip -categorize srcip | table srcip srcip_category
```

結果として得られるテーブルには2つのカラムが含まれます: `srcip`, および `srcip_category` の2つのカラムが含まれ、これらのカラムには"PRIVATE"、"PUBLIC"、"MULTICAST "のいずれかが格納されます。