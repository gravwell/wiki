# IP

ipモジュールは、列挙値をIP型に変換し、オプションでフィルタリングを行うことができます。これにより、例えば、JSON構造体からIPアドレスを含む文字列を抽出し、ipモジュールを使ってその文字列をIPアドレスに変換し、それが特定のサブネット内にあるかどうかをチェックすることができます。

## サポートされているオプション

* `-or`: "-or" フラグは、フィルタのいずれかが成功した場合に、 ipモジュールがエントリをパイプラインに続けることを許可するように指定します。
* `-categorize`: "-categorize"フラグが設定されている場合、モジュールは各列挙値を "PRIVATE"、"PUBLIC"、"MULTICAST "のいずれかにカテゴライズしようとします。`ip -categorize srcIP` を実行すると、カテゴリ文字列を含む "srcIP_category" という名前の列挙値が作成されます。

## 処理演算子

ipモジュールに渡された列挙値は、以下の演算子を使ってIPアドレスやサブネットと比較することができます。

| 演算子 | 名前 | 説明 |
|----------|------|-------------|
| == | 等しい | IPは指定されたアドレスと同じでなければなりません
| != | 等しくない | IPは指定されたアドレスと同じであってはなりません
| ~ | 含む | IPは指定されたサブネットのメンバーでなければなりません
| !~ | 含まない | IPは指定されたサブネットのメンバーであってはなりません

ipモジュールでは、標準的なプライベートネットワークのいずれかに一致するキーワードPRIVATEを定義します:

* 10.0.0.0/8
* 172.16.0.0/12
* 192.168.0.0/16
* 127.0.0.0/8
* 224.0.0.0/24
* 169.254.0.0/16
* fd00::/8
* fe80::/10

## 例

### 文字列をIPに変換する

JSON形式のエントリーに'ipaddr'フィールドが含まれていると仮定して、そのフィールドを抽出し、後で使用するためにIPアドレスに変換します:

```
tag=json json ipaddr | ip ipaddr
```

結果のIP列挙値は、元の列挙値を上書きするのではなく、別の列挙値名に割り当てることもできます:

```
tag=json json ipaddr | ip ipaddr as IP
```

### アドレスまたはサブネットによるフィルター

3番目のフィールドに接続元のIPアドレスが記述されたCSV形式のデータを想定すると、192.168.1.5 以外の接続はすべて削除することができます:

```
tag=csv csv [2] as srcip | ip srcip==192.168.1.5
```

We can also eliminate any connections which originated in the local subnet:

```
tag=csv csv [2] as srcip | ip srcip !~ 192.168.0.0/16
```

### PRIVATEキーワードの使用

3番目のフィールドに接続元のIPアドレスが記述されたCSV形式のデータを想定すると、 ipモジュールを使用してプライベートネットワークからのエントリのみを保持することができます:

```
tag=csv csv [2] as srcip | ip srcip ~ PRIVATE
```

### IPアドレスの分類

3番目のフィールドに接続元のIPアドレスが記述されたCSV形式のデータを想定して、IPモジュールを使用してIPアドレスごとにネットワークカテゴリを割り当てることができます:

```
tag=csv csv [2] as srcip | ip -categorize srcip | table srcip srcip_category
```

結果として得られるテーブルには2つのカラムが含まれます: `srcip`, および `srcip_category` の2つのカラムが含まれ、これらのカラムには"PRIVATE"、"PUBLIC"、"MULTICAST "のいずれかが格納されます。