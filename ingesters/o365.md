# Office365ログインジェスター

Gravwellは、Microsoft Office365ログのingesterを提供します。 ingesterは、サポートされているすべてのログタイプを処理できます。 ingesterを構成するには、Azure ActiveDirectory管理ポータル内に新しい*アプリケーション*を登録する必要があります。 これにより、ログへのアクセスに使用できる一連のキーが生成されます。 次の情報が必要になります。

* クライアントID：Azure管理コンソールを介してアプリケーション用に生成されたUUID
* クライアントシークレット：Azureコンソールを介してアプリケーション用に生成されたシークレットトークン
* Azure Directory ID：Azure ActiveDirectoryダッシュボードにあるActiveDirectoryインスタンスを表すUUID
* テナントドメイン：Office 365ドメインのドメイン（例： 「mycorp.onmicrosoft.com」

## 基本構成

O365インゲスターは、[ingester section](#!ingesters/ingesters.md#Global_Configuration_Parameters)で説明されている統一されたグローバル設定ブロックを使用します。 他の多くのGravwellインゲスターと同様に、O365インゲスターは複数のアップストリームインデクサー、TLS、クリアテキスト、名前付きパイプ接続、ローカルキャッシュ、ローカルロギングをサポートしています。

## コンテンツタイプの例

```
[ContentType "azureAD"]
	Content-Type="Audit.AzureActiveDirectory"
	Tag-Name="365-azure"

[ContentType "exchange"]
	Content-Type="Audit.Exchange"
	Tag-Name="365-exchange"

[ContentType "sharepoint"]
	Content-Type="Audit.SharePoint"
	Tag-Name="365-sharepoint"

[ContentType "general"]
	Content-Type="Audit.General"
	Tag-Name="365-general"

[ContentType "dlp"]
	Content-Type="DLP.All"
	Tag-Name="365-dlp"
```

## インストールと構成

まず、[ダウンロードページ](#!quickstart/downloads.md)からインストーラーをダウンロードしてから、ingesterをインストールします。

```
root@gravserver ~# bash gravwell_o365_installer.sh
```

Gravwellのサービスが同一マシン上に存在する場合、インストールスクリプトは自動的に`Ingest-Auth`パラメータを抽出し、適切に設定します。次に、`/opt/gravwell/etc/o365_ingest.conf`設定ファイルを開き、Office 365アカウント用に設定し、必要に応じてプレースホルダーフィールドを置き換えたりタグを修正したりする必要がある。以下のように設定を変更したら、コマンド `systemctl start gravwell_o365_ingest.service` でサービスを開始します。

以下の例は、ローカルマシン上のインデクサーに接続し（`Pipe-Backend-target`の設定に注意）、サポートされているすべてのログタイプからのログをフィードするサンプル構成を示しています。

```
[Global]
Ingest-Secret = IngestSecrets
Connection-Timeout = 0
Pipe-Backend-target=/opt/gravwell/comms/pipe #a named pipe connection, this should be used when ingester is on the same machine as a backend
Log-Level=ERROR #options are OFF INFO WARN ERROR
State-Store-Location=/opt/gravwell/etc/o365_ingest.state

Client-ID=79fb8690-109f-11ea-a253-2b12a0d35073
Client-Secret="<secret>"
Directory-ID=e8b7895e-109f-11ea-9dcc-93fb14b5dab5
Tenant-Domain=mycorp.onmicrosoft.com

[ContentType "azureAD"]
	Content-Type="Audit.AzureActiveDirectory"
	Tag-Name="365-azure"

[ContentType "exchange"]
	Content-Type="Audit.Exchange"
	Tag-Name="365-exchange"

[ContentType "sharepoint"]
	Content-Type="Audit.SharePoint"
	Tag-Name="365-sharepoint"

[ContentType "general"]
	Content-Type="Audit.General"
	Tag-Name="365-general"

[ContentType "dlp"]
	Content-Type="DLP.All"
	Tag-Name="365-dlp"
```
