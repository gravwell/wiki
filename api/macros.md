# マクロ API

Web APIは、検索マクロにアクセスしたり作成したりするためのメソッドを提供しています。検索マクロとは、検索の解析段階で展開される短い文字列から長い文字列へのマッピングのことです。

## SearchMacro の構造

Web サーバーはマクロを JSON 構造体で返しますが、これはフィールドの更新にも使用されます。構造体を送信してマクロを更新する場合、すべてのフィールドが更新されるわけではないことに注意してください (たとえば、LastUpdated フィールドを手動で変更することはできません)。フィールドはほとんど説明不要ですが、ここでは正確に説明します：

* ID: このマクロを表す一意の整数
* UID: マクロオーナーの整数UID
* GIDs: マクロへのアクセスが許可されている整数のグループIDのリスト
* Name: 検索クエリで入力されたマクロの短い名前です。
* Expansion: マクロの展開先の文字列
* LastUpdated: このマクロが最後に変更された時間
* Synced: (内部使用のみ)

## マクロのリストアップ

現在のユーザーが所有するすべてのマクロのリストを取得するには、`/api/macros` を GET してください。結果は以下のようになります。

```
[{"ID":1,"UID":1,"GIDs":null,"Name":"FOO","Expansion":"grep foo","LastUpdated":"2018-10-31T20:56:24.629561628Z","Synced":true}]
```

この例では、UID 1のユーザーが「FOO」という名前のマクロを1つ持っていて、それが「grep foo」という文字列に展開されます。マクロIDは1で、これは他のAPIでも使用できます。

### ユーザーIDによるマクロの取得

管理者ユーザーは、`/api/users/{uid}/macros` を GET して、`{uid}` を目的のユーザー ID に置き換えて、特定のユーザーのマクロの一覧を取得できます。管理者以外のユーザーは、このAPIを使って自分のマクロを取得することができます。

### グループ ID によるマクロの取得

管理者ユーザーやグループのメンバーは、`/api/groups/{gid}/macros` を GET することで、指定したグループがアクセスできるマクロの一覧を取得できます。

### すべてのマクロの取得

管理者ユーザーは、`/api/macros/all`でGETを実行することで、システム上のすべてのマクロの一覧を取得することができます。

## 特定のマクロの取得

特定のマクロの構造を取得するには、`/api/macros/{id}` を `{id}` をマクロの ID に置き換えて GET します。例えば、`/api/macros/1`をGETすると、以下のようになります。

```
{"ID":1,"UID":1,"GIDs":null,"Name":"FOO","Expansion":"grep foo","LastUpdated":"2018-10-31T20:56:24.629561628Z","Synced":true}
```

## 新しいマクロの作成

新しいマクロは `/api/macros` へのPOSTで作成することができます。リクエストのボディには、以下のようにNameとExpansionフィールド、そして(オプションで)GIDsフィールドを含める必要があります。

```
{"GIDs": [1, 2], "Name": "TEST", "Expansion": "grep test | count"}
```

作成が成功すると、新しいマクロのIDが返されます。この例では、新しいIDは2だったので、`/api/macros/2`をGETすると、新しいマクロのフルボディが得られます。

```
{"ID":2,"UID":1,"GIDs":null,"Name":"TEST","Expansion":"grep test | count","LastUpdated":"2018-10-31T21:05:34.231426316Z","Synced":true}
```

## マクロの更新

マクロの更新は、`/api/macros/{id}` へのPUTで、作成時と同じボディフォーマットを使って行うことができます。安全のために、変更がなくてもGIDs、Name、Expanionの各フィールドを毎回入力することをお勧めします。

更新に成功すると、HTTP 200が返され、更新されたマクロがボディに格納されます。

## マクロの削除

マクロの削除は、`/api/macros/{id}`のDELETEによって行われます。削除が成功すると、HTTP 200が返されます。