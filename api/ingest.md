# WebサーバーAPIを介したエントリの取り込み

Webサーバーは、エントリを直接取り込むためのAPIを提供します。 これは、自動化されたスクリプトを実行する場合、またはユーザーがファイルをインポートできるようにする場合に役立ちます。

## JSON形式のエントリの取り込み

自動化されたスクリプトは独自のエントリを作成し、それらを構造体のJSON配列として出荷します。 これには、データフィールドに任意のバイトを許可できるという利点があります。 各エントリの必須フィールドは次のとおりです。

* TS：タイムスタンプ（例："2018-02-12T11：06：44.215431364-07:00"）
* タグ：使用する文字列タグ（「syslog」など）
* データ：base64でエンコードされたバイト（例:"Zm9vCg =="）

したがって、1つは「foo」を含み、もう1つは「test」を含む2つのエントリをタグ`mytag`に送信するには、次のデータを使用して`/api/ingest/json`にPUTを実行します。

```
[ { "TS": "2018-02-12T11:06:44.215431364-07:00", "Tag": "mytag", "Data": "Zm9v" }, { "TS": "2018-02-12T11:06:45.215431364-07:00", "Tag": "mytag", "Data": "dGVzdA==" } ]
```

サーバーは、取り込んだエントリの数を返します。

## 行区切りファイルの取り込み

ユーザー提供のデータを取り込むには、行区切りファイルAPIが最も簡単なオプションです。これは、次のフォームパーツを使用して`/api/ingest/lines`へのマルチパートPOSTを実行することで構成されます。

* ユーザー提供のファイルを含む`file`という名前のファイル部分
* 目的の取り込みタグを含む`tag`という名前のフィールド
* オプションのフィールド`source`; これを設定すると、エントリのソース値が上書きされます。 このフィールドは、適切に形成されたIPv4またはIPv6アドレスである必要があります。
* オプションのフィールド`noparsetimestamp`; これを「true」に設定すると、各エントリから1つを解析しようとするのではなく、現在のタイムスタンプでエントリが強制的に取り込まれます。
* オプションのフィールド`assumelocaltimezone`; これを「true」に設定すると、タイムゾーンが明示的に指定されていない場合、エントリから抽出されたタイムスタンプは（UTCではなく）ローカルタイムゾーンにあると見なされます。

アップロードされたファイルは改行で分割されます。 各行は、個別のエントリとして取り込まれます。
 
