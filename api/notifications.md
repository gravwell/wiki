# 通知REST API
通知は、1人または複数のユーザーに表示されるメッセージです。通知には、表示されるテキストを含むメッセージフィールドと、オプションでメッセージに関連するURLであるリンクフィールドが含まれます。

通知には、タイプを含めることができます。タイプは、何かが重複することなく継続的に通知を送信できるように使用されます。例えば、ウェブサーバは Type==0xDEADBEEF で `Indexer X is down` という通知を追加し続けることができます。 タイプが同じなので、通知エンジンは古い通知を更新し続けます。

通知には、ターゲット通知とブロードキャスト通知の2つの形式があります。 ブロードキャスト通知はすべての人に届き、ターゲット通知は適切なUIDまたはGIDを持つユーザーにのみ届きます。 ブロードキャスト通知には、本来UID/GIDはありません（常に0になります）。

注意：他のユーザーに表示される通知を作成できるのは、adminユーザーのみです。一般ユーザーは、自分自身にのみ表示される通知を作成できます。

通知にはExpiresフィールドがあり、通知が自動的に削除される日を指定します。また、Sentフィールドがありますが、通常は空欄にしておき、サーバーが自動入力します。IgnoreUntilフィールドもオプションであり、IgnoreUntilの日付が未来にある通知は、その時までリクエストに戻ってきません。通知が空白の日付(Sent, Expires, IgnoreUntil)で追加された場合、それらはデフォルト値で入力されます。

次のような通知を考えてみましょう：

```
{
    "Broadcast": false,
    "Expires": "2019-04-23T03:44:01.776918756-06:00",
    "GID": 0,
    "IgnoreUntil": "0001-01-01T00:00:00Z",
    "Msg": "foobar",
	"Link": "https://gravwell.io",
    "Origin": "00000000-0000-0000-0000-000000000000",
    "Sender": 7,
    "Sent": "2019-04-22T21:44:01.776942432Z",
    "Type": 1,
    "UID": 7
}
```

この通知は、UID 7 のユーザーを対象としており、特定のグループを対象としていません。同じユーザーが作成したものです。通知のタイプは「1」です。これはブロードキャスト通知ではありません。これは 21:44 UTC に送信され、12 時間後に失効します。メッセージは「foobar」で、https://gravwell.io への関連するリンクを持っています。

通知を作成するとき、唯一の *truly* 必須フィールドは Msg です。対象となる通知を作成する場合、GIDおよび/またはUIDも指定しなければなりません。LinkとIgnoreUntilフィールドはオプションです。Broadcastフラグは、どのAPIエンドポイントが使用されているかに応じてサーバーによって設定されます。

Origin」フィールドは、インデクサによって生成される自動通知に使用され、無視することができます。

すべての通知は一過性のものです。 ウェブサーバ/フロントエンドが再起動すると、それらは失われます。

すべての通知にはIDがあり、各IDは単調に増加し、常にbase-10 uint64で表されます。

基本的なREST APIのURLは以下の通りです:

```
/api/notifications
/api/notifications/all/{id:[0-9]+}
/api/notifications/{id:[0-9]+}
/api/notifications/broadcast
/api/notifications/targeted
/api/notifications/targeted/self
```

リクエストの方法:

GET - 通知を引き出します。<br>
PUT - 特定の通知を更新します。<br>
POST - 新しい通知を追加します。<br>
DELETE - 特定の通知を削除します。<br>

## 通知ルール

* 管理者のみが、`/api/notifications/targeted/self` を除き、新しい通知を追加することができます。
* ユーザーは、自分が明示的に所有する(UIDが一致する)通知のみ更新できます。 GIDの一致では不十分です。
* ユーザーは、通知に関連するUIDまたはGIDを変更できません。
* ユーザーは、自分が所有していない通知を削除することはできません（UID が一致しません）。

### 新しい通知の追加

### ブロードキャスト通知またはターゲット通知の追加 (管理者のみ)

管理者は、`/api/notifications/broadcast`に通知構造をPOSTすることでブロードキャスト通知を作成したり、`/api/notifications/targeted`にPOSTすることでターゲット通知を作成することができます。明示的なタイプを持つブロードキャスト通知を作成するには、以下のようにPOSTします。

```
{
	"Msg": "This is a broadcast notification"
	"Type": 123
}
```

特定のグループを対象とした通知は、次のようになります:

```
{
	"Msg": "This is a targeted notification",
	"GID": 2
}
```

### セルフターゲティング通知の追加

管理者以外のユーザーは、`/api/notifications/targeted/self` へのPOSTで通知を作成できます。Type、Msg、Expires フィールドだけが尊重されることに注意してください。これらの通知はデフォルトで12時間の有効期限が設定されていますが、Expiresフィールドが過去や24時間以上先の場合は、現在の時刻から12時間に設定されます。

```
{
	"Msg": "This is a self-targeted notification"
}
```

## 通知の取得

ユーザーは `/api/notifications` への GET リクエストで、すべての通知を取得することができます。 特定の通知IDの後に作成されたすべての通知を取得するには、/api/notifications/{id}にGETを発行してください。 例えば、以前に0から10までの通知を見たことがある場合、/api/notifications/10をリクエストすると、そのユーザーがアクセスできる新しい通知のみを取得することができます。

### すべての通知を取得する(管理者のみ)

管理者は、`/api/notifications/all/`をGETすることで、UIDやGIDに関係なく、すべての通知を取得できます。

## 通知の更新

通知を更新するには、`/api/notifications/{id}`に対して、該当する通知のPUTリクエストを行います。

## 通知の削除

通知を削除するには、特定の通知IDに対して`/api/notifications/{id}`にDELETEリクエストを送ってください。管理者以外のユーザーは、自分のUIDを対象とした明示的な通知しか削除できないことに注意してください。