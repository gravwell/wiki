# Search Agentによる検索とスクリプトのスケジューリング

例えば、毎朝検索を実行して前夜の悪意ある行動を検出するなど、検索やスクリプトの実行を自動的に行うことが有利な場合があります。Gravwellの検索エージェントを使えば、検索や[検索スクリプト](scriptingsearch.md)をカスタマイズしたスケジュールで実行することができます。

スケジューリング機能では、通常の検索と[検索スクリプト](scriptingsearch.md)の両方をスケジュールすることができます。

## サーチエージェントの設定

Gravwell Search AgentはGravwellの主要なインストールパッケージに含まれ、デフォルトでインストールされるようになりました。ウェブサーバコンポーネントを `--no-webserver` フラグで無効にしたり、`--no-searchagent` フラグを設定すると、検索エージェントがインストールされなくなります。サーチエージェントはGravwellのDebianパッケージによって自動的にインストールされます。

サーチエージェントの設定(または無効化)についての詳細は[サーチエージェントのドキュメント](searchagent.md)を参照してください。

## スケジュール検索の管理

スケジュール検索の管理は、メインメニューの「自動化」サブメニューの下にある「Scheduled Searches」ページから行います。次のスクリーンショットは、1時間ごとに実行される1つのスケジュール検索を示しています。

![](sched1.png)

### スケジュール検索の作成

新しいスケジュール検索を作成するには、「Scheduled Searches」ページの右上隅にある「Add」ボタンをクリックします。新しいページが開きます。

![](newsched.png)

検索クエリを指定し、検索を実行する期間を指定し、名前と説明を付け、スケジュールを定義する必要があります。また、このスケジュール検索の結果を見ることができる1つ以上のグループを選択したり、[ラベル]を定義したり(#!gui/labels/labels.md)、インストールしたキットにスケジュール検索を割り当てたりすることもできます。

注意：Gravwellはcronスケジュール形式で検索の実行時間を指定します。cronに慣れていない方は、[Wikipediaの記事](https://en.wikipedia.org/wiki/Cron)や[スケジューリングを試すサイト](https://cron.help/)を参照してください。

以下では、1分ごとに実行され、過去1分間に何件のエントリーがあったかをカウントするシンプルなスケジュール検索を定義しています。

![](countsearch.png)

ここでは、「run after saving」オプションを選択していることに注意してください。これは、検索エージェントに、できる限り早く検索を実行し、その後、通常のスケジュールを開始するように指示しています。これは、ルックアップテーブルを更新するために検索を実行している場合に特に有効です。

保存」をクリックすると、検索はスケジュール検索リストに表示され、すぐに実行されて「最後の実行」フィールドが更新されます。

![](lastrun.png)

## スケジュールされたスクリプトの管理

スケジュールされたスクリプトは、メインメニューの "Automation "サブメニューにある "Scripts "ページで管理します。スクリプトは、スケジュール検索とまったく同じ方法で管理され、同じコントロールが利用できます。

### スケジュールスクリプトの作成

スケジュール検索を作成するには、[スクリプト]ページの右上にある[追加]ボタンをクリッ クします。新しいスクリプトのページが表示され、スクリプトを入力するためのテキストエリアが表示されます。

![](newscript.png)

スクリプト、名前、説明、スケジュールを入力したら、[保存]または[保存して終了]をクリックしてスクリプトを作成します。

### スクリプトのデバッグ

デフォルトでは、スクリプト編集画面の右側には「情報」タブが表示されていますが、右端のアイコンの列に注目してください。このチェックマークをクリックすると、スクリプトのテストに使用する「デバッグ」タブが表示されます。Debug」ボタンをクリックすると、Search Agentは印刷機能を有効にした状態で*できるだけ早くスクリプトを実行します。これは、問題のあるスクリプトをデバッグしようとするときに非常に役立ちます。以下の例では、非常にシンプルなスクリプトとデバッグ出力を示しています。

![](debugscript.png)

## 検索結果の表示

スケジュール検索の最後の結果を表示するには、「View Results」アイコンをクリックします。

![](results.png)

スケジュール検索の最新の結果セットが読み込まれます。

![](results2.png)

## スケジュール検索またはスクリプトの無効化

スケジュール検索を無効にすると、再度有効にするまでその検索は実行されません。検索を無効にするには、3ドットメニューを開いて追加オプションを表示し、「Disable」を選択します。

![](disable.png)

再度有効にするには、同じ手順を繰り返します。"Disable "ではなく、"Enable "と表示されます。

## 検索/スクリプトをすぐに実行する

スケジュール検索やスクリプトは、いつでもすぐに実行させることができます。その検索/スクリプトの3点メニューを開き、「Schedule immediately」を選択してください。検索エージェントは、できるだけ早くその検索を実行します。

![](immediate.png)

## スケジュール検索/スクリプトの削除

スケジュール検索を削除するには、「Delete」を選択します。

![](delete.png)