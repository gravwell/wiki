# 検索バーとクエリインターフェイス

データの調査は、自動化されたスクリプトからのアラートメールや、ダッシュボード上でユーザーが異変に気付いた時に始まるかもしれませんが、実際の*データ調査*では、通常、手動でクエリを実行し、異なる時間枠やクエリを繰り返して、興味のある情報を掘り下げていきます。このドキュメントでは、Gravwellが提供するクエリを構築・実行するための**ユーザーインターフェース**について説明します。実際にクエリを構築する方法については、[検索ドキュメント](#!search/search.md)を参照してください。

## 新規検索ページ

新規検索ページはGravwellユーザーのデフォルトのホームページです。また、UI左上のGravwellロゴをクリックするか、メインメニューを開いて「新規検索」を選択することでもアクセスできます。

![](検索バー.png)

このページでは、ゼロから新しい検索を入力したり、過去の検索を再実行したり、クエリライブラリから検索を読み込むことができます。また、希望のタイムフレームを選択したり、オプションでクエリのライブアップデートを有効にすることもできます。

### 手動で検索を行う

最初から検索を実行するには、単純に入力を開始します。`tag=* stats count by TAG | chart count by TAG`のような有効なクエリを入力すると、"Search Now"と"Background Search"のボタンが有効になります。この時点では、これらのボタンをクリックするか、「Enter」キーを押すことで、クエリを起動することができます。

## 検索履歴の確認

以前の検索を再実行するには、下矢印を押すか、検索バーの右端にあるリストアイコンをクリックします。

![](search-hist.png)

履歴リストから目的の検索をクリックします。これにより、履歴のドロップダウンが折りたたまれ、"今すぐ検索" をクリックして検索を実行します。

### クエリライブラリへのアクセス

クエリライブラリに保存されているクエリは、検索バーからも利用できます。検索履歴の場合と同様に、検索バーの右端にあるリストのアイコンをクリックし、ドロップダウンの 下部にある [クエリライブラリ] をクリックして表示を切り替えます。

![](search-library.png)

## タイムフレームの選択

デフォルトでは、クエリは直近1時間のデータを対象に実行されます。これは、クエリバーの下にあるTimeframeドロップダウンで簡単に変更できます。

![](timeframe.png)

"Last hour"を選択すると、現在の時刻からちょうど1時間前までの時間を対象に検索が行われます。9:22に検索を開始した場合、クエリは8:22から9:22までのデータを対象とします。"過去24時間"、"過去7日間"なども同様です。

一方、"This hour"を選択すると、直近の*1時間*の先頭から現在までのデータが検索されます。つまり、9:22に検索を開始した場合、9:00から9:22までのデータを検索します。"Today"、"This week"、"This month "なども同様に動作します。"Yesterday "は特別なケースで、前日の00:00から23:59までのデータを検索します。

"Date range"オプションを選択すると、以下のように開始日と終了日/時間のセレクタが表示されます。

![](daterange.png)

同様に、"Unix timestamp"では、Unixタイムスタンプ（エポックからの秒数）を手動で入力できるフィールドが用意されており、Unixタイムスタンプを使用する他のデータを参照する際に便利です。

![](unix.png)

"Custom duration "では、何年、何ヶ月、何日、何時間、何分、何秒前に検索を実行するかを入力します。以下のスクリーンショットでは、ユーザーが過去2日、3時間、12分を検索したいと指定しています。

![](custom.png)

最後に、「ISO 8601 duration」では、[ISO-8601 format](https://en.wikipedia.org/wiki/ISO_8601#Durations)で期間を指定することができます。下のスクリーンショットでは、ユーザーが「P13DT」と入力していますが、これは過去13日間を意味しています。

![](iso8601.png)

注："Date range"と"Unix timestamp"は、未来を検索するために使用することができ、これは不正なタイムスタンプでデータが取り込まれた場合に便利です。

## 検索結果ページ

クエリを実行すると、Gravwellは出力結果を表示する*検索結果ページ*を表示します。このページでは、結果のサブセクションへのドリルダウン、クエリの修正と再実行、タイムフレームの変更、結果の保存などを行うことができます。

![](results.png)

上のスクリーンショットにあるように、検索結果ページでは、現在のクエリがページの上部に表示されます。このボックスでクエリを編集し、虫眼鏡のアイコンをクリックしてクエリを再実行することができます。別のタイムフレームを使用したい場合は、カレンダーアイコンで別のタイムフレームを選択してから再実行します。

また、履歴/ライブラリドロップダウンアイコンを使って、検索履歴またはクエリライブラリのいずれかからクエリを完全に変更することもできます。これは、タイムフレームのサブリージョンを選択した後に便利です（「タイムフレームのサブセレクション」セクションを参照）。

検索結果ページには、検索結果に対する追加アクションのメニューがあり、下図のようにページの右側にある3つの縦のドットをクリックするとアクセスできます。このメニューの各オプションについては、以下のサブセクションで説明します。

![](menu.png)

### 結果の保存

このオプションは検索結果を保存したことを示します。検索結果は、ユーザーが検索を削除するまで、[永続的な検索](#!gui/persistent/persistent.md)ページでアクセス可能になります。

### クエリの保存

現在の検索結果をクエリライブラリに保存し、後で再利用できるようにします。

![](savequery.png)

### ダッシュボードに追加

このオプションを使用すると、既存のダッシュボードに検索結果を追加したり、この検索結果を最初のタイルとして新しいダッシュボードを作成したりすることができます。ダッシュボードの検索」フィールドを使用して、既存のダッシュボードをフィルタリングし、適切なダッシュボードを見つけることができます。

![](add-to-dash.png)

### 背景に送る

このオプションは、検索の完了までに予想以上の時間がかかっている場合に便利です。バックグラウンドに送信」をクリックすると、検索結果ページから移動した後も検索がバックグラウン ドで実行され、検索が完了するまでの間、他の作業を行うことができます。検索の状態を監視したり、完了した検索結果を表示するには、[Persistent Searches](#!gui/persistent/persistent.md)ページを参照してください。バックグラウンドでの検索はウェブサーバの再起動後も持続しないことに注意してください。

### スケジュール

スケジュール」をクリックすると、「新規スケジュール検索」のページが表示され、クエ リフィールドに現在の検索結果があらかじめ入力されます。また、タイムフレームセレクタには、可能であれば直近に実行したタイムフレームが設定されます。スケジュールされた検索に名前、説明、スケジュールを与えて、「保存」をクリックするだけです。

![](schedule.png)

### ダウンロード

"Download"メニューでは、検索結果をさまざまな形式でダウンロードすることができます。

![](download.png)

上のスクリーンショットでは、チャートのレンダラーがJSON形式とCSV形式のダウンロードを提供しています。例えば、チャートをCSV形式でダウンロードして、表計算ソフトに取り込むことができると便利です。

特に便利な組み合わせは、[raw renderer](#!search/raw/raw.md)からJSON形式の結果をダウンロードすることです。その結果のファイルをGravwellの[reimport ingester](https://github.com/gravwell/gravwell/tree/master/ingesters/reimport)を使って、同じエントリーを別のGravwellインスタンスに再インジェストすることができます。Gravwellのサポートに問題をメールで伝えると、テストのためにこの形式でエントリを送るように要求されることがあります。

### クエリURLの共有

"Share Query URL"を選択すると、他のユーザーにコピー＆ペーストできる URL が表示されます。この URL を開くと、先ほど実行したのと同じクエリが再実行されます。画面を見ることができない相手にデータを見せる場合に便利な方法です。

![](share.png)

### Start a template

"Start a template"オプションを選択すると、現在のクエリがあらかじめ入力されたNew Template pageページが開きます。テンプレートとは、基本的には変数*を含むGravwellの保存されたクエリです。テンプレートは、調査用ダッシュボードの構築や、アクショナブルと組み合わせて、以前の検索結果の一部に基づいてクエリを起動するために使用されます。テンプレート、アクショナブル、調査用ダッシュボードについては別の場所で説明しています。

![](template.png)

## タイムフレームのサブセレクション

Gravwellでは、多くのクエリで検索結果の上にタイムフレームサブセレクションのインターフェイスが表示されます。これは小さなチャートで、X軸はクエリのタイムフレーム、Y軸はエントリー数を表しています。

![](timeframe.png)

上のスクリーンショットでは、エントリーがタイムフレーム（6月7日16:41～6月8日14:41）全体にかなり均一に分布していることがわかります。次のスクリーンショットでは、エントリの分布がよりまばらで、エントリがまったく表示されない時間帯もあります。

![](timeframe-sparse.png)

timeframeセレクターを使って、検索結果の一部を拡大することができます。たとえば、ここでは過去1時間の検索結果を表示しています。

![](dhcp-top.png)

タイムフレームセレクターの上でマウスの左ボタンをクリックしたままにすると、タイムフレームの一部をハイライトすることができます。マウスボタンを離すと、Gravwellは選択された部分を拡大し、クエリを再実行することなく、適切な結果を再計算します。

![](dhcp-zoomed.png)

ズームインは複数回行うことができ、最小のズームレベル（元のクエリのタイムフレームによって決定される）まで行うことができます。この時点で、GUIはタイムフレームセレクタに2つの新しいボタンを追加します。矢印ボタンは、ズームレベルを1段階下げます。これは、複数回ズームインした後に戻りたい場合に便利です。"x"ボタンはズームを完全にキャンセルし、元のクエリのタイムフレームに戻ります。

クエリバーのタイムフレームボタンには、ドットが付いています。これは、この時点でクエリを再実行した場合、現在選択されているタイムフレーム*で実行されることを示しています。これは、広範囲の結果から始めて、ある特定の領域を掘り下げたい場合に非常に便利です。

注：すべてのクエリでタイムフレームセレクタが表示されるわけではありません。モジュールやモジュールオプションの中には（テーブルレンダラーの`-nt`フラグのように）、Gravwellを強制的に*non-temporal mode*にしてしまうものがあり、ズームができなくなってしまいます。

## ライブアップデートクエリ

ある特定のクエリを追跡し、新しいエントリがGravwellに入ってくるたびに検索結果を更新したい場合は、ライブアップデート機能を使うことができます。新規検索ページの"Live update"ボタンをクリックするか、検索結果ページの時間枠ドロップダウンメニューを使ってライブアップデートをオンにし、検索を再実行してください。

![](live-new.png)

![](live-results.png)

ライブアップデートをオンにした検索は、一定の間隔で再実行され、結果が更新されます。この場合、検索全体を再度実行する必要があるため、大量のデータを含む（実行に時間がかかる）検索は、ライブアップデートに適していない可能性があることに注意してください。

ライブアップデートが有効になっている検索では、検索結果ページに2つの新しいボタンが追加されます。

![](livebuttons.png)

"pause updates"と書かれた左のボタンは、ライブアップデートを一時的に無効にします。再度クリックすると、ライブアップデートが再び有効になります。

右側のボタンは、ライブアップデートの頻度を変更できます:

![](live-options.png)

デフォルトでは、検索結果は1分ごとに更新されます。10秒ごとに更新することもできますし、必要に応じて不定期に更新することもできます。