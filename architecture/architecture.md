# Gravwellシステムアーキテクチャ

Gravwellのシステムアーキテクチャセクションは、アーキテクチャの観点からGravwellがどのように展開および操作されるかについての情報を提供するように設計されています。すべてのインジェスターを単一のインデクサーに直接向けてGravwellの単純な単一ノードインスタンスを実行したい場合は、このセクションを安全に無視できます。システムアーキテクチャセクションは、システム管理者、DevOpsエンジニア、およびクラウドアーキテクト向けであり、より複雑なインスタンスをデプロイするためにGravwellの基盤となるトポロジとアーキテクチャについてより深く理解する必要があります。

## クラスタートポロジ

Gravwellは、高速に移動し、データストリームから情報を効果的に抽出するために必要な認知オーバーヘッドを削減するように設計された、高度な同時分散ストレージおよび検索システムです。1日に数百テラバイトに達する可能性のある大量のデータを効果的に保存、検索、管理するには、多数のストレージデバイスを利用する複数のマシンが必要です。1台のディスクで1台のマシンを立ち上げ、エンタープライズスループット要件に対処することは不可能です。

Gravwellの基本アーキテクチャは、インデクサー、インジェスター、およびWebサーバーを中心に設計されています。関係は1対1ではなく、すべてのコンポーネント（Webサーバーを除く）は、負荷分散、耐障害性、および利用可能なハードウェアの使用率を最大化するように設計されています。説明のために、これは単一のポイントからデータを監視する非常に単純な組織であると仮定しています。

![A simple cluster](SimpleCluster.png)

上記の基本インストールでは、3つのインデクサーにエントリを分散する単一のインジェスターを使用しています。インジェスター（FileFollowerと言う）は、マシン上のさまざまなデータソースを監視し、タイムスタンプを取得して、それらをGravwellクラスターに送信しています。インジェスターは、3つのインデクサー全体の負荷を分散し、インデクサーのいずれかが消えると再接続します。たとえば、1台のインデクサーが（ハードウェア障害またはシステムアップグレードのために）ダウンした場合、他の2台は一時的にスラックを拾い、障害が発生したインデクサーがオンラインに戻ったときにインテスターが再接続します。ingesterは消費キューです。つまり、1つのインジェスターが高速の場合、自然に消費量が増え、低速または過負荷のインデクサーは自然に消費量が少なくなります。

インジェスターにはあらゆる形とサイズがあり、インジェストAPIはオープンソースです。Gravwellはベースインジェスターのいくつかをオープンソース化しました。コミュニティが成長するにつれて、非常に幅広いソースからデータを取得するために、ますます多くのインジェスターがポップアップします。Gravwellはバイナリの取り込みと処理をサポートしているため、取り込むことができるものに制限はありません。データをアトミックアイテムとそれに関連付けられたタイムスタンプにカプセル化できる限り、Gravwellはそれを消費して検索します。

非常に柔軟な取り込みフレームワークにより、非常に複雑で安全なトポロジが可能になります。顧客は多くの場合、データ分析プラットフォームを他のインフラストラクチャから分割したいと考えています。セグメンテーションとは、ネットワーク内のすべてのワークステーションがインデクサーと直接対話できるようにすることは望ましくないことを意味します。ここでは、Grabwellは任意の深さのインゲスターフェデレーションをサポートします。つまり、ネットワーク分類の複数の層がある場合、ホームネットワークGravwellインジェスターを二重化して、パブリックネットワークからプライベート分析ネットワークに安全にデータを中継できます。例として、控えめなGravwellトポロジーがより複雑な企業からデータを収集しているという仮定があります。この企業には、公開Webサーバー、プライベートファイルサーバー、ドメインコントローラー、ファイアウォール、ワークステーション、およびプライベートスイッチング機器があります。ネットワークエンジニアとI.T.セキュリティ担当者がすべてを担当します。

エンジニアとI.T.は、よく考えられ安全な企業であること人々はビジネスのリソースと分離された領域を分割しました。一般向けWebサーバーは、Windowsワークステーションとは異なるネットワークセグメント上にあります。スイッチングギアにはプライベート管理LANがあり、各セグメントにはステートフルファイアウォールがあり、だれもすり抜けることはありません。このトポロジでは、すべてのデータソースがGravwellクラスターと直接通信することはできません。その代わりに、パブリックホームサーバーなどの信頼できないネットワークからGravwell分析クラスターのようなより信頼できるネットワークにリレーするために、デュアルホーム化および強化されたingesterリレーを展開します。Windowsドメインマシンはすべてログをドメインコントローラーにプッシュし、ドメインコントローラーはすべてをGravwellにプッシュしています。スイッチはポートアクティビティログとスフローレコードをプッシュし、ファイアウォールはアラートをプッシュし、ファイルサーバーはファイルアクセスログをプッシュしています。

![An example of an enterprise topology](ExampleEnterprise.png)

このわずかに複雑なセットアップは、企業がすべての形状およびサイズのログをGravwellにプッシュし、企業全体の可視性を大幅に向上させる方法を示しています。非常に異なるログソースを取得することで、スタッフは1か所から大量のデータにアクセスして検索できるようになり、問題の診断と修正に必要な時間が短縮されます。ITオペレーションは、コアスイッチからのスフローログをファイアウォールログとWebサーバーアクセスレコードに関連付けて、ユーザーがページにアクセスできない理由を特定することにより、Webサーバーの問題をデバッグできます。セキュリティ運用グループは、ドメインボックス間を移動するサムドライブを追跡したり、ポートアクティビティとログインを関連付けて、不正な機器を接続している従業員を特定したりできます。Gravwellは、あらゆる種類のデータソースを監視および相関させます。生のビデオをインデクサーにフィードできるビデオインスターターもあります。顔認識を使用して、バッジリーダーのスワイプとドアの顔の数を相関させたいと思ったことはありませんか？ Gravwellはそれを行うことができます。

## インデクサーストレージトポロジ

ravwellは、ストレージを含むスタック全体で並行性のテーマを採用しています。インデクサーは、単一のストレージアレイを持つ単一のストレージシステムではなく、ストレージオーケストレーターです。1つのインデクサーには最大65,000のウェルを含めることができ、各ウェルには多くのストレージアレイを含めることができます。井戸は均一である必要はありません。グラブウェルのアーキテクトは、さまざまなデータソースのスループット要件を見積もり、それに応じてストレージリソースを割り当てることができます。各ストレージアレイは同時に動作し、検索パイプラインにフィードし、インジェスターから非同期に消費します。ストレージの非同期で分散された性質により、複数のストレージアレイにウェルをストライピングすることでスループットを向上させることができます。例として、Gravwellインスタンスがsyslog、sflow、およびraw PCAPインジェスターからフィードしている場合、システム設計者は3つのウェルを割り当てる場合があります。デフォルトでは、syslogがキャプチャされ、基本的なウィンドウロギングの一部は、スループットが重要ではなく、データが長期間保持される単一の大きな回転ディスクアレイを指す場合があります。スフローウェルのスループット要件はわずかに高くなりますが、保持要件は低くなります。そのため、中程度のサイズの単一のSSDを使用しています。ただし、PCAPに特化したものは非常に高速である必要があり、回転するディスクや単一のSSDだけでは機能しません。非常に高いスループットの取り込みと検索の要件により、複数のストレージアレイを活用するための使用が促進される場合があります。

![An example of how Gravwell storage may be organized](ExampleStorage.png)

ストレージアレイの同時実行性とGravwellの構成可能性により、非常に高いスループットが実現します。ハイエンドNVMEドライブは2GB / s以上の読み取り速度を維持でき、単一のウェルでこれらのいくつかをストライピングすることは、Grabwellが1秒あたり何ギガバイトでも保存および読み取りできることを意味します。ハイエンドストレージは、ボトルネックをストレージ速度からメモリ帯​​域幅にシフトするだけかもしれません。クアッドチャンネルメモリと2つのNVMEベースのSSDストレージアレイを備えたセミモダンハードウェアのテストインスタンスの一部では、ノードあたり3GB / sを超える検索速度が見られました。AMD EpicまたはIntel E5 v4 CPUを備えた中規模のクラスターでは、適切に作成されたクエリでノードあたり10GB / sを簡単に確認できます。

## インジェスタートポロジー

Gravwell取り込みAPIは、高速でシンプルになるように設計されています。APIとGravwellのインジェスターの多くは、他のツールではこれまで利用できなかったデータをユーザーが取得して取得することを奨励するために、オープンソースです。Gravwellチームは、学術研究、民間のセキュリティコンサルティング、高度なセキュリティの研究開発など、さまざまなバックグラウンドを持っています。その幅広い多様性がGravwellの取り込みと適用性に関するビジョンを形成し、チームは、非常に大規模なマルチレベルセキュリティインストールでの使用を可能にしつつ、小さなインスタンスを簡単に迅速に展開できるように努力しました。

コアインジェストメカニズムに必要なデータ項目は、バイト配列、タイムスタンプ、タグ（APIによって提供される）の3つだけです。単純なインストールでは、インデクサーと直接通信するインジェスターが数人いる場合があり、より複雑なインジェスターは、信頼できないエンクレーブから高セキュリティエンクレーブにデータがシャッフルされるため、複数レベルのフェデレーションを持つ場合があります。可視性は、セキュリティ、分析、ハント操作の鍵です。データを分離したり、オペレーターが手動でデータを相関させる必要がある複数のインストールを強制することは受け入れられません。Gravwellは、インジェストリレーインジェスターを介してフェデレーションを実現します。これは、両側でインジェストAPIを話し、デュアルホームマシンがデータを集約してリレーできるようにします。

![An example of a complex ingest structure](IngestRelay.png)