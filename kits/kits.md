# キット

キットとは、Gravwell が他のシステムに簡単にインストールできるように、多くの関連アイテム（ダッシュボード、クエリ、スケジュール検索、自動抽出器）を束ねたものです。キットには Netflow データの解析ツールや自作システムの監視ツールなどが含まれます。Gravwell Inc. は、一般的なユースケースのためにあらかじめキットを提供していますが、ユーザーは Gravwell UI から独自のキットを構築することもできます。

## キットに含まれるもの

キットを構成する要素はたくさんあります。まず、キットの「コンテンツ」ですが、これは2つのカテゴリーに分かれます。

* アイテム：ダッシュボード、スケジュール検索、マクロ、アクショナブルなど、通常の Gravwell コンポーネント。
* 設定用マクロ：これは、キットが自分自身を構成するために使用する特殊なマクロで、使用するタグの選択などにおいて、より柔軟性を持たせることができます。たとえば、すべてのクエリで `tag=netflow` を使用するのではなく、Netflow キットでは `tag=$NETFLOW_KIT_TAG` とし、NETFLOW_KIT_TAG という名前の設定用マクロを定義することができます。インストール時に、キットは、どのタグまたはタグに Netflow レコードが含まれているかをユーザーに尋ねます。

他にも、キットを識別するのに役立ついくつかのポイントがありますので、覚えておくと便利です。

* ID：キットを識別します。Gravwell では、"io.gravwell.netflowv5" のように、Androidアプリケーションと同様の名前空間を使用しています。
* バージョン：キットは時間の経過とともに更新されることがありますが、バージョン番号はそれを追跡し、Gravwell は新しいキットのバージョンを自動的に通知します。
* 名前：「Netflow v5」など、キットのわかりやすい名前。
* 説明：キットの機能についての詳細な説明です。
* MinVersion/MaxVersion：キットによっては、Gravwell の特定の機能を必要とするものがあります。それらの機能が確実に利用できるように、これらのフィールドでは、キットと互換性のある Gravwell のバージョンを指定します。
* 依存関係：キットは、Linux ディストリビューションのパッケージのように、他のキットに依存することがあります。例えば、Gravwell の Netflow v5 キットは Network Enrichment キットに依存しています。依存関係は、キットと一緒に自動的にインストールされます。

## インストールされたキットを見る

キットの管理は、メインメニューにある「キット」ページで行います。キットのページを開くと、まずインストールされているキットのリストが表示されます。下の画像では、2つのインストール済みキットが表示されています。

![](listkits.png)

いずれかのキットをクリックすると、選択したキットのコンテキストに入り、キットの内容が表示されます。

![](showkit.png)

UI はキットのコンテキストに入っているので、コンテキストを離れるまではそのキットの内容しか表示されません。例えば、メインメニューから Dashboards ページにアクセスすると、そのキットに含まれる2つのダッシュボードのみが表示されます。

![](kitcontext.png)

ページの上部にある「Kits / Netflow v5 / Dashboards」というテキストに注目してください。これは、私たちがその特定のキットの中にいることを示しています。キットのコンテキストを離れるには、メインメニューボタンの横にある Gravwell のロゴをクリックします。

## キットのインストール

キットをインストールするには、メインのキットページの右上にある「キットを管理」ボタンをクリックして、キット管理モードに入る必要があります。キットがインストールされていない場合は、UI が自動的に「利用可能なキット」タブに移動しますが、そうでない場合はデフォルトの表示で現在インストールされているキットが表示されます。キットを探してインストールするには、画面上部の「利用可能なキット」ラベルをクリックします。

![](availablekits.png)

キットの詳細ボタンをクリックすると、キットの詳細が表示されます。インストールするキットが決まったら、「キットのインストール」ボタンをクリックします。システムはキットをダウンロードして、インストールのためのウィザードをポップアップします。下のスクリーンショットでは、IPFIX キットを選択してインストールしています。最初のページには、キットに含まれるアイテムのリストが表示されます。

![](wizard1.png)

内容を確認したら、チェックボックスをクリックし、「Next」ボタンを選択します。ウィザードには、キットに同梱されているライセンスが表示されます。複数のライセンスがある場合は、左のリストからそれぞれのライセンスを選択し、各チェックボックスをクリックしてから続行してください。

![](wizard2.png)

次に、キットで定義されているものがあれば、ウィザードは設定マクロの入力を促します。設定マクロとは、キットに同梱されているクエリをインストールの時に設定するためのもので、通常はデフォルト値が設定されていますが、入力すべき内容を把握するための説明も含まれています。このスクリーンショットでは、どのタグに IPFIX レコードが含まれているかを知る必要があります。

![](wizard3.png)

ウィザードの最後のページでは、追加オプションの入力を求められます。「Override Existing Items」にチェックを入れると、システム上に既に存在する矛盾したオブジェクトを上書きします。例えば、「foo」という名前のリソースを作成したのに、キットが「foo」という名前のリソースも作成してしまう場合です。「Group Access」ドロップダウンでは、キットのコンテンツを見ることができるグループを任意に選択することができます。管理者は、キットをグローバルにインストールして、すべてのユーザーが見ることができるようにすることもできます。

![](wizard4.png)

「Deploy」ボタンをクリックすると、キットとその依存関係がインストールされます。この作業には1分ほどかかることがありますが、最終的にはインストールされたキットの1つとしてリストアップされます。

注：インストールウィザードを中止した場合、キットはインストールされませんが、ダウンロードしたキットは「My kits」ページの「Kits Staged for Deployment」というラベルの下に表示されます（下図）。このステージングされたキットを削除するか、インストールウィザードを再開するかを選択することができます。

![](staged.png)

## キットのアップグレード

Gravwell は定期的に公式キットサーバーにアップデートを行います。インストールしたキットにアップデートがあると、そのキットのタイルに「アップグレード」ボタンが表示されます。

![](upgradekit.png)

このボタンをクリックすると、インストールウィザードと同様のアップグレードウィザードが起動します。最も重要な違いは、**バックアップ**オプションです。キットに含まれていたアイテムを変更した場合、ウィザードはその旨を通知し、変更されたアイテムをコピーまたはダウンロードするためのオプションを提供します。以下のスクリーンショットでは、3つのリソースが変更され、ウィザードがそれらのダウンロードリンクを提供していることがわかります。ダッシュボードのような他のオブジェクトは、ダウンロードではなく、アップグレード中に「クローン」を作成することができます。

![](backup.png)

変更された項目がない場合は、「バックアップ」のステップは表示されません。ウィザードの残りの部分はインストールウィザードと同じですが、グループアクセスなどのデフォルトはすでに設定されているはずです。

注意：キットを新しいバージョンにアップグレードすると、前のバージョンのコンテンツは完全に削除されます。準備ができるまで、ウィザードの最後にある「Deploy」ボタンをクリックしないでください。

## キットのアンインストール

インストールしたキットを削除するには、メインのキットのページの右上にある「Manage Kits」ボタンをクリックして、キット管理モードに入ります。その後、削除したいキットのゴミ箱アイコンを選択します。確認のためのダイアログが表示されます。

![](uninstall-confirm.png)

「アンインストール」をクリックすると、キットの内容を手動で変更していない限り、キットが削除されます。キットの内容を変更した場合は、その旨を知らせる2つ目のダイアログが表示され、処理を中止する最後のチャンスが与えられます。

![](uninstall-warn.png)

## キットサーバ

デフォルトでは、Gravwell は `https://kits.gravwell.io/kits/list` で利用可能なキットをチェックします。利用可能なキットページにキットが表示されていない場合は、Gravwell のウェブサーバからそのサーバにアクセスできるかどうかを確認してください。現在、自分でキットサーバを構築できるようなツールセットを開発中です。

`curl`と`jq`がインストールされていれば、このコマンドスニペットを使って、利用可能なキットのリストを得ることができます。
```
curl "https://kits.gravwell.io/kits/list" | jq .[].ID
```
