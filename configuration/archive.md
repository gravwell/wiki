# クラウドアーカイブ

Gravwellはクラウドアーカイブと呼ばれるエイジアウトの仕組みをサポートしています。クラウドアーカイブは、データを削除する前にリモートでアーカイブできるリモートサービスです。Gravwell Cloud Archiveは、積極的に検索する必要はないけれども、保持しておく必要があるというデータを長期的にアーカイブ保存するための優れた方法です。クラウドアーカイブサービスは、様々なストレージプラットフォーム上でホストすることができ、リモートで低コストのストレージプラットフォームを提供するように設計されています。クラウド・アーカイブの設定は、ウェル単位で有効にすることができ、どのデータ・セットが長期アーカイブを保証するかを決めることができます。

アーカイブシステムでは、通常のエイジアウト中にデータが削除される前に、アーカイブサーバーにデータが正常にアップロードされることが保証されています。

注意：インデクサーは、アーカイブサーバーへのアップロードに成功するまでデータを削除しません。接続の問題や設定ミス、ネットワークのスループットの低下などの理由でインデクサがアップロードできなかった場合、データは削除されません。データを削除できない状態では、インデクサーがストレージを使い果たして新しいデータの取り込みができなくなってしまう可能性があります。クラウドアーカイブのアップロードが完了しなかった場合は、ユーザーインターフェースに失敗の通知が表示されます。

注意：クラウドアーカイブシステムは、転送中にデータを圧縮するため、アップロード時に多少のCPUリソースを必要とします。データをリモートシステムにプッシュする際にも、利用可能な帯域幅と CPU に応じて時間がかかります。クラウドアーカイブがこれら追加的な時間を必要とすることを考慮し、エイジアウトのパラメーターを設定する際には、少し余裕を持たせておくようにしてください。

## インデクサーの設定

すべてのインデクサーには、リモートアーカイブサーバーと認証トークンを指定するグローバルなクラウドアーカイブ設定ブロックがあります。設定ブロックは、グローバルセクションの "[cloud-archive]" ヘッダを使用して指定します。ウェルをクラウドアーカイブ有効に設定するには、ウェル内に "Archive-Deleted-Shards=true" ディレクティブを追加してください。


以下に、3つのウェルを使用した構成例を示します:

```
[global]
Web-Port=443
Control-Port=9404
Ingest-Port=4023

[Cloud-Archive]
	Archive-Server=test.archive.gravwell.io
	Archive-Shared-Secret="password"

[Default-Well]
	Location=/opt/gravwell/storage/default/
	Cold-Location=/opt/gravwell/cold_storage/default/
	Hot-Duration=1d
	Cold-Duration=30d
	Delete-Frozen-Data=true
	Archive-Deleted-Shards=true

[Storage-Well "netflow"]
	Location=/opt/gravwell/storage/netflow/
	Hot-Duration=7d
	Delete-Cold-Data=true
	Archive-Deleted-Shards=true
	Tags=netflow

[Storage-Well "raw"]
	Location=/opt/gravwell/storage/raw/
	Hot-Duration=7d
	Delete-Cold-Data=true
	Tags=pcap
```

上記の例では、設定された3つのウェル（デフォルト、ネットフロー、および 生データ）があります。デフォルトのウェルは、ホットストレージ層とコールドストレージ層の両方を使用しており、データは通常コールドストレージ層から ロールアウトされるときにアーカイブされます。netflow用ウェルにはホット ストレージ層のみが含まれており、そのデータは通常 7 日後に削除されるときにアップロードされます。生データのウェルは、クラウドアーカイブを有効にしていない（Archive-Deleted-Shards=false）ため、そのウェルのデータはアップロードされません。

## クラウドアーカイブのホスティング

クラウドアーカイブサービスは、セルフホスティング型で、他の大規模なインフラに統合することも可能なモジュールサービスです。クラウドアーカイブサービスのユーザーご自身でホスティングしたい場合や、リモートでご自身のデータをアーカイブしたい場合は、sales@gravwell.io までご連絡ください。

注意：インデクサーは、*インデクサーに*割り当てられた顧客ライセンス番号を使用してクラウドアーカイブサービスへの認証を行います。[オーバーウォッチ](#!distributed/overwatch.md)の構成の場合、この顧客ライセンス番号は*ウェブサーバーに*割り当てられているライセンス番号とは異なる場合があります。